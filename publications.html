<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Publications • Beholder Lab</title>
  <meta name="description" content="Beholder Lab — Cognitive neuroscience of belief, attention, and decision-making.">
  <meta property="og:title" content="Publications • Beholder Lab">
  <meta property="og:site_name" content="Beholder Lab">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="en_US">
  <link rel="icon" href="/assets/favicon.ico">
  <link rel="stylesheet" href="/assets/styles.css">
</head>

<body>
<header class="site-header">
  <div class="container header-inner">
    <a class="brand" href="/">
      <img src="/assets/beholderlogo.svg" alt="Beholder Lab logo" class="logo">
      <span>Beholder Lab</span>
    </a>
    <nav aria-label="Primary">
      <button class="nav-toggle" aria-expanded="false" aria-controls="nav">Menu</button>
      <ul id="nav" class="nav">
        <li><a href="/index.html">Home</a></li>
        <li><a href="/people.html">People</a></li>
        <li><a href="/research.html">Research</a></li>
        <li><a href="/publications.html" aria-current="page">Publications</a></li>
        <li><a href="/media.html">Media</a></li>
        <li><a href="/contact.html">Contact</a></li>
      </ul>
    </nav>
  </div>
</header>

<main class="container">
  <h1>Publications</h1>
  <p class="lede">Selected papers and preprints by the Beholder Lab.</p>

  <!-- Filtro -->
  <div class="pub-filters" aria-label="Filter publications by tag">
    <div class="filter-row">
      <strong>Filter by:</strong>
      <div id="tag-filter" class="tag-filter" role="group" aria-label="Tags"></div>
      <button type="button" id="clear-filters" class="btn-clear" hidden>Clear</button>
    </div>
  </div>

  <!-- Qui verrà montata la lista -->
  <div id="pub-root" data-json="./assets/publications.json">
    <p style="opacity:.8">Loading publications…</p>
  </div>
</main>

<footer class="site-footer">
  <div class="container footer-inner">
    <p>© <span id="year"></span> Beholder Lab • Headed by Stefano Lasaponara (PhD), Associate professor at Sapienza University of Rome - Psychology Department </p>
    <p><a href="/contact.html">Contact</a> • <a href="mailto:stefano.lasaponara@uniroma1.it">stefano.lasaponara@uniroma1.it</a></p>
  </div>
</footer>

<!-- Renderer + Filtri (standalone) -->
<script>
(function () {
  // ---------- Helpers ----------
  const pretty = (t) => t.replace(/^tech:/,'')
                         .replace(/^topic:/,'')
                         .replace(/-/g,' ')
                         .replace(/\b\w/g, c => c.toUpperCase());

  // ---------- Render publications from JSON ----------
  const root = document.getElementById('pub-root');
  if (!root) return;
  const jsonUrl = root.dataset.json || './assets/publications.json';

  fetch(jsonUrl)
    .then(r => {
      if (!r.ok) throw new Error('HTTP ' + r.status + ' for ' + jsonUrl);
      return r.json();
    })
    .then(pub => {
      if (!Array.isArray(pub) || pub.length === 0) {
        root.innerHTML = '<p style="opacity:.8">No publications found.</p>';
        return;
      }

      const ul = document.createElement('ul');
      ul.className = 'publist';

      pub.sort((a,b) => (b.year||0) - (a.year||0)).forEach(p => {
        const li = document.createElement('li');
        li.className = 'pub';
        li.setAttribute('data-year', p.year || '');
        li.setAttribute('data-tags', (p.tags||[]).join(','));
        li._tags = p.tags || [];

        const titleHTML = p.link
          ? `<a class="title" itemprop="headline" href="${p.link}" target="_blank" rel="noopener">${p.title || ''}</a>.`
          : `<span class="title" itemprop="headline">${p.title || ''}</span>.`;

        const doiHTML = p.doi
          ? `<a href="https://doi.org/${p.doi.replace(/^https?:\/\/doi\.org\//,'')}"
               class="doi" itemprop="identifier" target="_blank" rel="noopener"
               title="https://doi.org/${p.doi.replace(/^https?:\/\/doi\.org\//,'')}">DOI</a>`
          : '';

        const pdfHTML = p.pdf ? ` • <a href="${p.pdf}" class="pdf" itemprop="url">PDF</a>` : '';

        li.innerHTML = `
          <article itemscope itemtype="https://schema.org/ScholarlyArticle">
            <span class="authors" itemprop="author">${p.authors || ''}</span> (${p.year || ''}).
            ${titleHTML}
            <span class="venue" itemprop="isPartOf">${p.venue || ''}</span>.
            ${doiHTML}${pdfHTML}
            <ul class="tags"></ul>
          </article>
        `;

        const tagUl = li.querySelector('.tags');
        (p.tags || []).forEach(t => {
          if (t.startsWith('project:')) {
            const slug = t.split(':')[1];
            tagUl.insertAdjacentHTML('beforeend',
              `<li><a class="tag is-project" href="/research.html#${slug}" data-tag="${t}">${slug.replace(/-/g,' ')}</a></li>`);
          } else {
            tagUl.insertAdjacentHTML('beforeend',
              `<li><button type="button" class="tag" data-tag="${t}">${pretty(t)}</button></li>`);
          }
        });

        ul.appendChild(li);
      });

      root.replaceWith(ul);

      // dopo il render, attiva i filtri
      initTagFilters();
    })
    .catch(err => {
      console.error('Error loading publications:', err);
      root.innerHTML = `
        <p style="opacity:.8">
          Unable to load publications.<br>
          <small>Check that <code>${jsonUrl}</code> exists and is publicly reachable.</small>
        </p>`;
    });

  // ---------- Tag Filter UI ----------
  function initTagFilters() {
    const pubList = document.querySelector('.publist');
    const items = Array.from(pubList.querySelectorAll('.pub'));
    const filterHost = document.getElementById('tag-filter');
    const clearBtn = document.getElementById('clear-filters');

    // Raccogli tag (escludi project:)
    const tagSet = new Set();
    items.forEach(li => {
      const raw = (li.getAttribute('data-tags') || '').split(',').map(s => s.trim()).filter(Boolean);
      raw.forEach(t => { if (!t.startsWith('project:')) tagSet.add(t); });
      li._tags = raw;
    });

    // Crea bottoni
    const frag = document.createDocumentFragment();
    Array.from(tagSet).sort().forEach(tag => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'tag pill';
      btn.dataset.tag = tag;
      btn.setAttribute('aria-pressed', 'false');
      btn.textContent = pretty(tag);
      frag.appendChild(btn);
    });
    filterHost.innerHTML = '';
    filterHost.appendChild(frag);

    // Stato attivo
    const active = new Set();
    filterHost.addEventListener('click', (e) => {
      const btn = e.target.closest('button.tag.pill');
      if (!btn) return;
      const tag = btn.dataset.tag;
      if (active.has(tag)) {
        active.delete(tag);
        btn.setAttribute('aria-pressed', 'false');
        btn.classList.remove('is-active');
      } else {
        active.add(tag);
        btn.setAttribute('aria-pressed', 'true');
        btn.classList.add('is-active');
      }
      applyFilter();
    });

    clearBtn.addEventListener('click', () => {
      active.clear();
      filterHost.querySelectorAll('button.tag.pill').forEach(b => {
        b.setAttribute('aria-pressed', 'false');
        b.classList.remove('is-active');
      });
      applyFilter();
    });

    function applyFilter() {
      const on = active.size > 0;
      clearBtn.hidden = !on;
      items.forEach(li => {
        if (!on) { li.hidden = false; return; }
        const ok = Array.from(active).every(t => (li._tags||[]).includes(t));
        li.hidden = !ok;
      });
      // Aggiorna querystring
      const params = new URLSearchParams(window.location.search);
      if (on) params.set('tags', Array.from(active).join(','));
      else params.delete('tags');
      history.replaceState(null, '', window.location.pathname + (params.toString() ? `?${params}` : ''));
    }

    // Inizializza da URL
    const qs = new URLSearchParams(window.location.search).get('tags');
    if (qs) {
      qs.split(',').forEach(tag => {
        const btn = filterHost.querySelector(`button[data-tag="${CSS.escape(tag)}"]`);
        if (btn) {
          active.add(tag);
          btn.setAttribute('aria-pressed', 'true');
          btn.classList.add('is-active');
        }
      });
      applyFilter();
    }
  }
})();
</script>

<!-- (opzionale) il tuo script globale, se ti serve altrove -->
<script defer src="/assets/script.js"></script>
</body>
</html>
