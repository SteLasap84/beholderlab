<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Publications • Beholder Lab</title>
  <meta name="description" content="Beholder Lab — Cognitive neuroscience of belief, attention, and decision-making.">
  <meta property="og:title" content="Publications • Beholder Lab">
  <meta property="og:site_name" content="Beholder Lab">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="en_US">
  <link rel="icon" href="/assets/favicon.ico">
  <link rel="stylesheet" href="/assets/styles.css">
  <style>
  /* --- FILTRI (Year, Technique, Project) --- */
  .pub-filters{margin:.75rem 0 1rem}
  .filter-row{display:flex;gap:.6rem;flex-wrap:wrap;align-items:center;margin:.4rem 0}
  
  .chip,.tag-btn,.btn-clear{
    border:1px solid #70b7ff;          /* celeste tenue */
    color:#b8dcff;                     /* testo celeste chiaro */
    background:transparent;
    padding:.2rem .6rem;
    border-radius:999px;
    cursor:pointer;
    font-size:.9rem;
    line-height:1.2;
    transition:all .2s ease;
  }

  .chip:hover,.tag-btn:hover{
    background:#70b7ff22;              /* leggero bagliore */
    color:#ffffff;
  }

  .chip.is-active,.tag-btn.is-active{
    background:#70b7ff;
    color:#0e1a2b;                     /* testo scuro su sfondo chiaro */
    border-color:#70b7ff;
  }

  .tag-badges .badge{
    border:1px solid #70b7ff;
    color:#70b7ff;
    border-radius:999px;
    padding:.1rem .5rem;
    font-size:.75rem;
    opacity:.95;
  }

  .pub-count{opacity:.7;font-size:.9rem}
  .group-label{font-weight:600}
</style>

</head>

<body>
<header class="site-header">
  <div class="container header-inner">
    <a class="brand" href="/">
      <img src="/assets/beholderlogo.svg" alt="Beholder Lab logo" class="logo">
      <span>Beholder Lab</span>
    </a>
    <nav aria-label="Primary">
      <button class="nav-toggle" aria-expanded="false" aria-controls="nav">Menu</button>
      <ul id="nav" class="nav">
        <li><a href="/index.html">Home</a></li>
        <li><a href="/people.html">People</a></li>
        <li><a href="/research.html">Research</a></li>
        <li><a href="/publications.html" aria-current="page">Publications</a></li>
        <li><a href="/media.html">Media</a></li>
        <li><a href="/contact.html">Contact</a></li>
      </ul>
    </nav>
  </div>
</header>

<main class="container">
  <h1>Publications</h1>
  <p class="lede">Selected papers and preprints by the Beholder Lab.</p>

  <!-- FILTRI -->
  <div class="pub-filters" aria-label="Filter publications">
    <div class="filter-row">
      <span class="group-label">Year:</span>
      <div id="year-filter" class="year-filter" role="group" aria-label="Year"></div>
    </div>
    <div class="filter-row">
      <span class="group-label">Technique:</span>
      <div id="tech-filter" class="tech-filter" role="group" aria-label="Technique"></div>
    </div>
    <div class="filter-row">
      <span class="group-label">Project:</span>
      <div id="proj-filter" class="proj-filter" role="group" aria-label="Project"></div>
      <button type="button" id="clear-filters" class="btn-clear" hidden>Clear</button>
      <span id="pub-count" class="pub-count"></span>
    </div>
  </div>

  <!-- Qui verrà montata la lista -->
  <div id="pub-root" data-json="./assets/publications.json">
    <p style="opacity:.8">Loading publications…</p>
  </div>
</main>

<footer class="site-footer">
  <div class="container footer-inner">
    <p>© <span id="year"></span> Beholder Lab • Headed by Stefano Lasaponara (PhD), Associate professor at Sapienza University of Rome - Psychology Department </p>
    <p><a href="/contact.html">Contact</a> • <a href="mailto:stefano.lasaponara@uniroma1.it">stefano.lasaponara@uniroma1.it</a></p>
  </div>
</footer>

<script>
(function () {
  const root = document.getElementById('pub-root');
  if (!root) return;
  const jsonUrl = root.dataset.json || './assets/publications.json';

  // ---- Vocabolari ufficiali ----
  const TECH = [
    "Review/Meta-analysis","Behavioural study","Single Case","Neuropsychological Patients",
    "EEG","TMS","fMRI","fNIRS","Pupillometry","Computational Neuroscience"
  ];
  const PROJ = [
    "Attention","Belief","Predictive Coding","Spatial representation of number/time magnitudes","Miscellaneous"
  ];

  // ---- Auto-mapping se tech/project mancano nel JSON ----
  function inferTech(p){
    const s = ((p.title||'')+' '+(p.venue||'')).toLowerCase();
    const out = new Set();

    if (/(meta[-\s]?analysis|systematic review|umbrella review|ale meta[-\s]?analysis)/.test(s)) out.add("Review/Meta-analysis");
    if (/(single[-\s]?case|case report)/.test(s)) out.add("Single Case");
    if (/(patient|patients|lesion|stroke|neuropsycholog|neglect|parkinson|tbi|brain injury)/.test(s)) out.add("Neuropsychological Patients");

    if (/\beeg\b|electroencephal|event[-\s]?related potential|erp\b/.test(s)) out.add("EEG");
    if (/\btms\b|transcranial magnetic/.test(s)) out.add("TMS");
    if (/\bfmri\b|functional magnetic resonance/.test(s)) out.add("fMRI");
    if (/\bfnirs\b|near[-\s]?infrared|nirs\b/.test(s)) out.add("fNIRS");
    if (/pupil|pupill/.test(s)) out.add("Pupillometry");
    if (/model(ing|led|s)?|computational|reinforcement learning|q-?learning|bayesian|drift[-\s]?diffusion|hmm\b/.test(s)) out.add("Computational Neuroscience");

    // Behavioural: se è studio sperimentale e non è solo review
    if (!out.has("Review/Meta-analysis") && /(task|trial|reaction time|rt\b|participants?|experiment|behavioral|behavioural)/.test(s)) {
      out.add("Behavioural study");
    }

    // Se nulla riconosciuto, lascia vuoto (potrai compilarlo a mano)
    return Array.from(out);
  }

  function inferProject(p){
    const s = ((p.title||'')+' '+(p.venue||'')).toLowerCase();

    if (/attention|orienting|alerting|posner|ant\b|vigilance|attentional/.test(s)) return "Attention";
    if (/belief|confirmation|update|updating|fake news|confidence|tpj\b|mentalizing|theory of mind/.test(s)) return "Belief";
    if (/predictive|prediction|priors?|prediction error|bayesian/.test(s)) return "Predictive Coding";
    if (/snarc|space[-\s]number|number magnitude|numerical|time|temporal|mental time|stearc|spatial representation/.test(s))
      return "Spatial representation of number/time magnitudes";
    return "Miscellaneous";
  }

  // ---- Render ----
  fetch(jsonUrl).then(r=>{
    if(!r.ok) throw new Error('HTTP '+r.status+' for '+jsonUrl);
    return r.json();
  }).then(list=>{
    // normalizza + integra campi
    list.forEach(p=>{
      // usa year del JSON (già presente)
      // tecnica/progetto: usa se presenti, altrimenti inferisci
      let tech = [];
      if (Array.isArray(p.tech)) tech = p.tech.slice();
      else if (p.tech && typeof p.tech === 'string') tech = [p.tech];
      else tech = inferTech(p);

      let project = [];
      if (Array.isArray(p.project)) project = p.project.slice();
      else if (p.project && typeof p.project === 'string') project = [p.project];
      else project = [inferProject(p)];

      p._tech = tech.filter(t => TECH.includes(t));
      p._project = project.filter(pr => PROJ.includes(pr));
    });

    // costruisci lista
    const ul = document.createElement('ul');
    ul.className = 'publist';

    list.sort((a,b)=>(b.year||0)-(a.year||0)).forEach(p=>{
      const li = document.createElement('li');
      li.className = 'pub';
      li.dataset.year = p.year || '';
      li.dataset.tech = (p._tech||[]).join('|');
      li.dataset.project = (p._project||[]).join('|');

      const titleHTML = p.link
        ? `<a class="title" itemprop="headline" href="${p.link}" target="_blank" rel="noopener">${p.title||''}</a>.`
        : `<span class="title" itemprop="headline">${p.title||''}</span>.`;

      const doiHTML = p.doi
        ? `<a href="https://doi.org/${p.doi.replace(/^https?:\/\/doi\.org\//,'')}" class="doi" itemprop="identifier" target="_blank" rel="noopener">DOI</a>`
        : '';

      const pdfHTML = p.pdf ? ` • <a href="${p.pdf}" class="pdf" itemprop="url">PDF</a>` : '';

      li.innerHTML = `
        <article itemscope itemtype="https://schema.org/ScholarlyArticle">
          <span class="authors" itemprop="author">${p.authors||''}</span> (${p.year||''}).
          ${titleHTML}
          <span class="venue" itemprop="isPartOf">${p.venue||''}</span>. ${doiHTML}${pdfHTML}
          <div class="tag-badges">
            ${(p._tech||[]).map(t=>`<span class="badge">${t}</span>`).join('')}
            ${(p._project||[]).map(pr=>`<span class="badge">${pr}</span>`).join('')}
          </div>
        </article>
      `;
      ul.appendChild(li);
    });

    root.replaceWith(ul);
    initFilters(list);
  }).catch(err=>{
    console.error(err);
    root.innerHTML = `<p style="opacity:.8">Unable to load publications.<br><small>Check <code>${jsonUrl}</code>.</small></p>`;
  });

  // ---- Filtri ----
  function initFilters(list){
    const items = Array.from(document.querySelectorAll('.publist .pub'));
    const yearHost = document.getElementById('year-filter');
    const techHost = document.getElementById('tech-filter');
    const projHost = document.getElementById('proj-filter');
    const clearBtn = document.getElementById('clear-filters');
    const countEl = document.getElementById('pub-count');

    // Years
    const years = Array.from(new Set(list.map(p=>p.year).filter(Boolean))).sort((a,b)=>b-a);
    yearHost.innerHTML = `<button type="button" class="chip is-active" data-year="">All</button>` +
      years.map(y=>`<button type="button" class="chip" data-year="${y}">${y}</button>`).join('');

    // Technique buttons (nell'ordine definito)
    techHost.innerHTML = TECH.map(t=>`<button type="button" class="tag-btn" data-tech="${t}">${t}</button>`).join('');

    // Project buttons (nell'ordine definito)
    projHost.innerHTML = PROJ.map(p=>`<button type="button" class="tag-btn" data-proj="${p}">${p}</button>`).join('');

    // Stato
    let activeYear = null;
    const activeTech = new Set();
    const activeProj = new Set();

    // Interazioni
    yearHost.addEventListener('click', e=>{
      const b=e.target.closest('button.chip'); if(!b) return;
      yearHost.querySelectorAll('.chip').forEach(x=>x.classList.remove('is-active'));
      b.classList.add('is-active');
      activeYear = b.dataset.year || null;
      apply();
    });
    techHost.addEventListener('click', e=>{
      const b=e.target.closest('button.tag-btn'); if(!b) return;
      const t=b.dataset.tech;
      if(activeTech.has(t)){activeTech.delete(t); b.classList.remove('is-active');}
      else {activeTech.add(t); b.classList.add('is-active');}
      apply();
    });
    projHost.addEventListener('click', e=>{
      const b=e.target.closest('button.tag-btn'); if(!b) return;
      const p=b.dataset.proj;
      if(activeProj.has(p)){activeProj.delete(p); b.classList.remove('is-active');}
      else {activeProj.add(p); b.classList.add('is-active');}
      apply();
    });
    clearBtn.addEventListener('click', ()=>{
      activeYear=null; activeTech.clear(); activeProj.clear();
      yearHost.querySelectorAll('.chip').forEach((b,i)=>b.classList.toggle('is-active', i===0));
      techHost.querySelectorAll('.tag-btn').forEach(b=>b.classList.remove('is-active'));
      projHost.querySelectorAll('.tag-btn').forEach(b=>b.classList.remove('is-active'));
      apply();
    });

    function apply(){
      const yearOn = !!activeYear;
      const techOn = activeTech.size>0;
      const projOn = activeProj.size>0;
      clearBtn.hidden = !(yearOn||techOn||projOn);

      let shown=0;
      items.forEach(li=>{
        const okYear = !yearOn || String(li.dataset.year)===String(activeYear);
        const liTech = (li.dataset.tech||'').split('|').filter(Boolean);
        const liProj = (li.dataset.project||'').split('|').filter(Boolean);
        const okTech = !techOn || Array.from(activeTech).every(t=>liTech.includes(t));
        const okProj = !projOn || Array.from(activeProj).every(p=>liProj.includes(p));
        const show = okYear && okTech && okProj;
        li.hidden = !show;
        if (show) shown++;
      });
      countEl.textContent = shown ? `${shown} result${shown>1?'s':''}` : '0 results';

      // URL condivisibile
      const params = new URLSearchParams(window.location.search);
      if(yearOn) params.set('year', activeYear); else params.delete('year');
      if(techOn) params.set('tech', Array.from(activeTech).join('|')); else params.delete('tech');
      if(projOn) params.set('proj', Array.from(activeProj).join('|')); else params.delete('proj');
      history.replaceState(null,'',window.location.pathname + (params.toString()?`?${params}`:''));
    }

    // Init da URL
    const params = new URLSearchParams(window.location.search);
    const qy = params.get('year'); if(qy){ activeYear=qy; yearHost.querySelectorAll('.chip').forEach(b=>b.classList.toggle('is-active', b.dataset.year===qy)); }
    const qt = (params.get('tech')||'').split('|').filter(Boolean);
    const qp = (params.get('proj')||'').split('|').filter(Boolean);
    qt.forEach(t=>{ const btn=techHost.querySelector(`[data-tech="${CSS.escape(t)}"]`); if(btn){activeTech.add(t); btn.classList.add('is-active');} });
    qp.forEach(p=>{ const btn=projHost.querySelector(`[data-proj="${CSS.escape(p)}"]`); if(btn){activeProj.add(p); btn.classList.add('is-active');} });
    apply();
  }
})();
</script>
</body>
</html>
